<mat-card class="cardWithShadow">
  <form [formGroup]="participationForm" (ngSubmit)="onSubmit()">
    <div class="row justify-content-between">
      <div class="col-lg-4">
        <mat-form-field appearance="outline" class="w-100 hide-hint">
          <mat-label>Select Period</mat-label>
          <mat-select
            formControlName="period"
            (selectionChange)="onPeriodChange($event)"
          >
            <mat-option *ngFor="let period of periods" [value]="period">
              {{ period }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-lg-4">
        <mat-form-field appearance="outline" class="w-100 hide-hint">
          <mat-label>Max Score</mat-label>
          <input
            matInput
            type="number"
            formControlName="maxScore"
            (input)="onMaxScoreChange()"
          />
        </mat-form-field>
      </div>
      <div class="col-lg-4">
        <mat-form-field appearance="outline" class="w-100 hide-hint">
          <mat-label>Attendance %</mat-label>
          <input
            matInput
            type="number"
            formControlName="attendancePercentage"
          />
        </mat-form-field>
      </div>
    </div>

    <mat-card class="cardWithShadow m-t-20">
      <div class="table-responsive">
        <table mat-table [dataSource]="dataSource" class="w-100">
          <!-- Student ID Column -->
          <ng-container matColumnDef="studentId">
            <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
              Student ID
            </th>
            <td mat-cell *matCellDef="let element">
              {{ element.studentId }}
            </td>
          </ng-container>

          <!-- Student Name Column -->
          <ng-container matColumnDef="studentName">
            <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
              Student Name
            </th>
            <td mat-cell *matCellDef="let element">
              {{ element.studentName }}
            </td>
          </ng-container>

          <!-- Earned Points Column -->
          <ng-container matColumnDef="earnedPoints">
            <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
              Earned Points
            </th>
            <td mat-cell *matCellDef="let element; let i = index">
              <mat-form-field
                appearance="outline"
                class="w-100 hide-hint"
                [formGroup]="getStudentFormGroup(i)"
              >
                <input
                  matInput
                  type="number"
                  formControlName="earnedPoints"
                  [placeholder]="participationForm.get('maxScore')?.value"
                />
                <mat-error
                  *ngIf="
                    getStudentFormGroup(i)!
                      .get('earnedPoints')!
                      .hasError('required')
                  "
                >
                  Required
                </mat-error>
                <mat-error
                  *ngIf="
                    getStudentFormGroup(i)!.get('earnedPoints')!.hasError('min')
                  "
                >
                  Cannot be negative
                </mat-error>
                <mat-error
                  *ngIf="
                    getStudentFormGroup(i)!.get('earnedPoints')!.hasError('max')
                  "
                >
                  Exceeds max score
                </mat-error>
              </mat-form-field>
            </td>
          </ng-container>

          <!-- Comments Column -->
          <ng-container matColumnDef="comments">
            <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
              Comments
            </th>
            <td mat-cell *matCellDef="let element; let i = index">
              <mat-form-field
                appearance="outline"
                class="w-100 hide-hint"
                [formGroup]="getStudentFormGroup(i)"
              >
                <input matInput type="text" formControlName="comments" />
              </mat-form-field>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

          <!-- No Data Row -->
          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" colspan="4">No Students Found</td>
          </tr>
        </table>
      </div>
    </mat-card>

    <div class="row justify-content-end m-t-20">
      <button mat-flat-button type="submit" color="primary" class="m-r-10">
        Submit Participation
      </button>
    </div>
  </form>
</mat-card>
